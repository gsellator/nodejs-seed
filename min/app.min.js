var express=require("express"),mongoose=require("mongoose");model=require("./models/model"),auth=require("./helpers/auth");var homeCtrl=require("./controllers/home"),loginCtrl=require("./controllers/login"),adminCtrl=require("./controllers/admin"),bddUri="mongodb://localhost/amecourt",apiUri="http://127.0.0.1:3000";mongoose.connect(bddUri,function(e){e?console.log("Mongo error:"+bddUri+". "+e):console.log("Mongo success: "+bddUri)});var app=express();app.set("view engine","ejs"),app.use(express.static(__dirname+"/public")),app.use(express.bodyParser());var padStr=function(e){return 10>e?"0"+e:""+e};app.locals.dateToDDMMYYYY=function(e){return null==e?"-":padStr(e.getDate())+"/"+padStr(1+e.getMonth())+"/"+padStr(e.getFullYear())},app.get("/",function(e,o){o.writeHead(301,{Location:"/home"}),o.end()}),app.get("/home",homeCtrl.get),app.get("/admin",auth.private,adminCtrl.get),app.get("/login",loginCtrl.get),app.post("/login",loginCtrl.post),app.get("/logout",function(e,o){o.writeHead(302,{"Set-Cookie":'access_token=""',"Content-Type":"text/plain",Location:"/login"}),o.end()}),app.use(function(e,o){o.setHeader("Content-Type","text/plain"),o.send(404,"Page introuvable !")}),app.listen(3100,function(){console.log("Express server listening on port 3100")});